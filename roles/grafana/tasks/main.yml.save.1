- name: Install grafana
  apt:
    name: https://dl.grafana.com/enterprise/release/grafana-enterprise_8.5.3_amd64.deb
    state: latest

- name: "Grafana configuration file copy"
  template:
    src: "grafana.conf.j2"
    dest: /etc/grafana/grafana.ini
  notify: event_restart_grafana

- name: "Grafana server started"
  service:
    name: grafana-server
    enabled: true
    state: started

- name: "Check if Grafana is accessible."
  uri:
    url: http://127.0.0.1:3000
    method: GET
    status_code: 200
- name: Install and set up grafana on Ubuntu 20.04 hosts: ubuntusrv become: yes gather_facts: False tasks: - name: Update apt repo and cache on all Ubuntu box apt: update_cache: yes force_apt_get: yes cache_valid_time: 3600 - name: Upgrade all packages on 
    servers
      apt: upgrade: dist force_apt_get: yes - name: Install required packages apt: name: - gnupg2 - curl - software-properties-common - name: Add the Grafana GPG key shell: | curl https://packages.grafana.com/gpg.key | sudo apt-key add - 
        add-apt-repository "deb https://packages.grafana.com/oss/deb stable main"
      args: warn: no - name: Install the grafana package apt: name: grafana state: present update_cache: yes notify: - Start grafana
        - Enable grafana
